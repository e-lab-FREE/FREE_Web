{% extends 'free/base.html' %}
{% load static %}
{% load i18n %}
{% load django_tables2 %}

{% block headscript%}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}



<div class="right floated thirteen wide computer sixteen wide phone column" id="content">
    <div style="padding-top:17px;padding-bottom:10px">
        <h1 >Executions in database and cleanup</h1>
     </div>

    <div class="ui raised very padded text container segment">
    <div>
        <canvas id="myChart"></canvas>
      </div>
      <div class="ui text">
        To delete older executions, define a threshold in the next form. <br>
        Executions older than the threshold (and corresponding results) will be permanently deleted.
        </div>
      <div class="ui form">
        <div class="inline  field">
          <label>Threshold</label>
           <input class="three wide" type="number" id="days-input" placeholder="Number of days">
        </div>
        <button class="ui button" onclick="delete_older()">Submit</button>
    </div>

</div>
</div>

<script>


    function delete_older(){
        // '{"experiment_name": "Pendulo", "config_experiment": {"DeltaX":'+ String(DeltaX)+', "Samples":'+String(Samples)+' }}'
        HEADERS = {
            "X-CSRFToken":'{{ csrf_token }}',
            }
         console.log("delete")
        n_days = $("#days-input").val()
        console.log(n_days)
        endpoint="/free-admin/executions/delete/"+n_days

        axios({
            method: 'delete', //you can set what request you want to be
            url: endpoint,
            headers: HEADERS,
        }).then(response => {
            console.log('delete', response);
            location.reload();
        }).catch(console);
    }

    $(document).ready(function() {

        const labels = {{executions_creation_dates}};
        const data = {
            labels: labels,
            datasets: [{
                label: 'Experiments',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: {{executions_creation_count}},
            }]
        };

        const config = {
        type: 'bar',
        data: data,
        options: {
            scales: {
            y: {
                title:{
                    display: true,
                    text: "Number of experiments"
                },
                ticks: {
                    precision: 0
                },
                beginAtZero: true
            },
            x: {
                title:{
                    display: true,
                    text: "Days since creation"
                },
            }
            }
        },
        };


    const myChart = new Chart(document.getElementById('myChart'), config );
    })
  </script>

{% endblock %}

{% include 'free/layout/scripts.html' %}

